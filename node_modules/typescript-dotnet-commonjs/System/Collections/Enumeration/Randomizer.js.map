{"version":3,"sources":["System/Collections/Enumeration/Randomizer.ts"],"names":[],"mappings":";AAAA;;;GAGG;;AAEH,+DAA4D;AAE5D,2CAAqC;AAErC;;;GAGG;AACH;IAAmC,8BAAuB;IAKzD,oBACC,MAA2B,EACV,WAA2B;QAA3B,4BAAA,EAAA,mBAA2B;QAF7C,YAIC,iBAAO,SAGP;QALiB,iBAAW,GAAX,WAAW,CAAgB;QAG5C,KAAI,CAAC,OAAO,GAAG,oBAAO,CAAC,MAAM,CAAC,CAAC;QAC/B,KAAI,CAAC,QAAQ,GAAG,KAAI,CAAC,OAAO,CAAC,MAAM,CAAC;;IACrC,CAAC;IAES,iCAAY,GAAtB;QAEC,IAAM,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC;QACxB,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,GAAC,CAAC,CAAC;IACzB,CAAC;IAED,6BAAQ,GAAR;QAEC,IAAM,CAAC,GAAG,IAAI,CAAC;QACf,IAAG,CAAC,CAAC,YAAY,EAAE,EACnB;YACC,IACC,CAAC,GAAG,IAAI,CAAC,QAAQ,EAAE,iBAAiB;YACpC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAC,CAAC,CAAC,EAAE,YAAY;YAC7C,CAAC,GAAG,IAAI,CAAC,OAAO,EAChB,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC,EACZ,IAAI,GAAG,CAAC,GAAG,CAAC,CAAC;YAGd,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,qCAAqC;YACrD,CAAC,CAAC,IAAI,CAAC,GAAQ,IAAI,CAAC,CAAC,4BAA4B;YAEjD,IAAG,CAAC,IAAI,CAAC,WAAW,IAAI,IAAI,GAAC,EAAE,IAAE,CAAC,EAAE,UAAU;gBAC7C,CAAC,CAAC,MAAM,GAAG,IAAI,CAAC;YAEjB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;YACrB,CAAC,CAAC,QAAQ,GAAG,KAAK,CAAC;YACnB,CAAC,CAAC,cAAc,EAAE,CAAC;YACnB,OAAO,IAAI,CAAC;SACZ;QAED,OAAO,KAAK,CAAC;IACd,CAAC;IAED,0BAAK,GAAL;QAEC,IAAG,IAAI,CAAC,WAAW,EACnB;YACC,IAAG,CAAC,IAAI,CAAC,OAAO;gBAAE,MAAM,gDAAgD,CAAC;YACzE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;YACpC,iBAAM,KAAK,WAAE,CAAC;SACd;;YAEA,MAAM,uEAAuE,CAAC;IAChF,CAAC;IAED,4BAAO,GAAP;QAEC,iBAAM,KAAK,WAAE,CAAC,CAAC,qCAAqC;QACpD,IAAI,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC;QACf,IAAK,CAAC,OAAO,GAAG,IAAI,CAAC;QAC3B,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC;QACpB,IAAG,CAAC;YAAE,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;IACpB,CAAC;IAES,iCAAY,GAAtB;QAEC,OAAO,KAAK,CAAC;IACd,CAAC;IAGF,iBAAC;AAAD,CA3EA,AA2EC,CA3EkC,2CAAoB,GA2EtD;AA3EY,gCAAU","file":"Randomizer.js","sourcesContent":["/*!\r\n * @author electricessence / https://github.com/electricessence/\r\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\r\n */\r\n\r\nimport {SimpleEnumerableBase} from \"./SimpleEnumerableBase\";\r\nimport {ForEachEnumerable} from \"./ForEachEnumerable\";\r\nimport {toArray} from \"./Enumerator\";\r\n\r\n/**\r\n * Creates a randomized version of the source.\r\n * Note: An iterator will always require a arrayCopy (buffer) to pull random results one by one.\r\n */\r\nexport class Randomizer<T> extends SimpleEnumerableBase<T>\r\n{\r\n\tprivate readonly _buffer:T[];\r\n\tprivate _pointer:number;\r\n\r\n\tconstructor(\r\n\t\tsource:ForEachEnumerable<T>,\r\n\t\tprivate readonly _allowReset:boolean = false)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis._buffer = toArray(source);\r\n\t\tthis._pointer = this._buffer.length;\r\n\t}\r\n\r\n\tprotected _canMoveNext():boolean\r\n\t{\r\n\t\tconst p = this._pointer;\r\n\t\treturn !isNaN(p) && p>0;\r\n\t}\r\n\r\n\tmoveNext():boolean\r\n\t{\r\n\t\tconst _ = this;\r\n\t\tif(_._canMoveNext())\r\n\t\t{\r\n\t\t\tconst\r\n\t\t\t\tp = this._pointer, // Where were we?\r\n\t\t\t\ti = Math.floor(Math.random()*p), // Pick one.\r\n\t\t\t\tb = this._buffer,\r\n\t\t\t\tvalue = b[i],\r\n\t\t\t\tlast = p - 1;\r\n\r\n\r\n\t\t\tb[i] = b[last]; // Take the last one and put it here.\r\n\t\t\tb[last] = <any>null; // clear possible reference.\r\n\r\n\t\t\tif(!this._allowReset && last%32==0) // Shrink?\r\n\t\t\t\tb.length = last;\r\n\r\n\t\t\tthis._pointer = last;\r\n\t\t\t_._current = value;\r\n\t\t\t_.incrementIndex();\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\treset():void\r\n\t{\r\n\t\tif(this._allowReset)\r\n\t\t{\r\n\t\t\tif(!this._buffer) throw \"Randomizer cannot be reset.  Already disposed.\";\r\n\t\t\tthis._pointer = this._buffer.length;\r\n\t\t\tsuper.reset();\r\n\t\t}\r\n\t\telse\r\n\t\t\tthrow \"Reset not allowed.  To allow for reset, specify so when constructing.\";\r\n\t}\r\n\r\n\tdispose():void\r\n\t{\r\n\t\tsuper.reset(); // Note... don't call this.reset() :|\r\n\t\tlet b = this._buffer;\r\n\t\t(<any>this)._buffer = null;\r\n\t\tthis._pointer = NaN;\r\n\t\tif(b) b.length = 0;\r\n\t}\r\n\r\n\tprotected getIsEndless():boolean\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n}"]}